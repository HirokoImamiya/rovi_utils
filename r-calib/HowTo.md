# ロボットキャリブレーション

### 1. キャリブレーションボード  
[gridboard](gridboard.pdf)

### 2. ロボットキャリブレーションユーティリティの起動  
**キャリブレーション**を起動する前に、必ず**VTを停止**してください。VTの停止、キャリブレーションの起動とも、ダッシュボードから行います。

### 3. 教示  
キャリブレーションは１のボードを床などに固定し、様々な位置からこのボードを撮影することで実施します。キャリブレーションを再実施することも予想されるので、これらの撮影点を教示しておくことを推めます。  
この際のプログラムは以下の手順で作成します。
- ホーム位置の設定  
ボードとの距離をカメラの標準ワーキングディスタンスとし、ボードの画像がビューワーの中心なる位置をホーム位置とします。  
ソフトがボードを認識すると、図のようにマーカがオーバレイされます。ほぼ全ての●が認識されるよう調整します。調整は(ライブ調整/カメラ露光時間)によって明るさを調整します。環境照度が低いときは、「プロジェクタ」をストロボモードに切り替えます。<br clear="all">
<img src="fig1.png" height="200" />
<br clear="all">
- カメラ姿勢  
ホーム位置を基準とし、この位置からXYZ軸の順に下表に示す角度分の回転させた姿勢を、基準カメラ姿勢と呼びます。  
１番目の姿勢はホーム位置の姿勢と同じです。  
例えば６番目の姿勢は、まずホーム位置に移動して、そこからX軸回りに20度回転、次にY軸20度回転させた姿勢です。

|姿勢#|X軸回転|Y軸回転|Z軸回転|
|:----|:----|:----||:----|
|1|0|0|0|
|2|20|0|0|
|3|-20|0|0|
|4|0|20|0|
|5|0|-20|0|
|6|20|20|0|
|7|-20|20|0|
|8|20|-20|0|
|9|-20|-20|0|
|10|0|0|60|
|11|0|0|120|
|12|0|0|-60|
|13|0|0|-120|

- 撮影点の教示  
カメラ姿勢を設定することで、ボードはビューワから外れます。次は、ボードの中心がビューワの中心に来るよう、X軸およびY軸を移動させます。こうして決めた点を、教示点として記憶します。  
先の表に示す全ての姿勢に対して教示します。

- キャプチャコマンド  
ビジョンコントローラはキャプチャコマンド<sup>(1)</sup>で撮影を指示します。キャプチャコマンドは撮影点へ移動後１秒程度のセトリングタイマー後に送信するようプログラムします。

### 4. 解析  
1. 評価  
解析結果のTransformは"カメラ/カメラマウント変換"に表示されています。[TFに反映]ボタンを押すと結果がTFに反映されRvizで見ることができます。下図のようにcameraフレームが実際のカメラの位置に表示されていればキャリブレーション成功です。<br clear="all">
<img src="fig3.png" height="200" align="right" />  <img src="fig4.png" height="200" align="right" />
<br clear="all">
2. 保存  
上側のパネルの「保存」ボタンを押して、キャリブレーション結果を保存します。

### 5.ロボットキャリブレーションユーティリティの終了  
起動とは逆に、先に**キャリブレーション**を停止、**VTを起動**します。
